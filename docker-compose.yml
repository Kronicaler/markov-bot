version: '1.2.0'

services:
  jaeger:
    image: jaegertracing/all-in-one:1.52
    restart: unless-stopped
    ports:
      - 16686:16686

  mariadb:
    image: mariadb
    restart: unless-stopped
    environment:
      MARIADB_ROOT_PASSWORD: ${DB_PASS}
      MARIADB_DATABASE: markov_bot
    volumes:
      - ./data/mariadb:/var/lib/mysql:Z
    deploy:
      resources:
        limits:
          memory: 500M
    ports:
      - 3306-3306
      
  adminer:
    image: adminer
    restart: always
    ports:
      - 8080:8080

  markov_bot:
    image: kronicaler/markov_bot
    container_name: markov_bot
    environment:
      - DISCORD_TOKEN
      - APPLICATION_ID
      - OTLP_ENDPOINT
      - DATABASE_URL=mysql://root:${DB_PASS}@mariadb/markov_bot
      - RUST_LOG=error,markov_bot=info
    build:
      context: ./
      dockerfile: dockerfile
    restart: unless-stopped
    volumes:
      - ./data:/app/data:Z

volumes:
  markovbot:
